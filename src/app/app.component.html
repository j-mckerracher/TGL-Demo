<div class="app-container">
  <header class="header">
    <div class="header-title">
      <h1>Tiered Gossip Learning (TGL) vs Peer-to-Peer</h1>
      <div class="header-subtitle">Interactive Network Propagation Demo</div>
    </div>

    <div class="playback-controls">
      <span class="frame-info">
        Round: <strong>{{ currentRound() }}</strong> / {{ maxRounds() }}
      </span>
      <button class="control-btn" type="button" disabled title="Previous Round">‚èÆ</button>
      <button class="control-btn primary" type="button" (click)="togglePlayback()" title="Play/Pause">
        {{ isPlaying() ? '‚è∏' : '‚ñ∂' }}
      </button>
      <button class="control-btn" type="button" disabled title="Next Round">‚è≠</button>
      <button class="control-btn" type="button" (click)="onReset()" title="Reset">‚Üª</button>
    </div>
  </header>

  <app-info-banner></app-info-banner>

  <aside class="sidebar">
    <section class="sidebar-section">
      <div class="section-title">Legend</div>
      <div class="legend-items">
        @for (item of legendItems; track item.label) {
          <div class="legend-item">
            <div class="legend-dot" [style.background]="item.color"></div>
            <span>{{ item.label }}</span>
          </div>
        }
      </div>
    </section>

    <section class="sidebar-section">
      <div class="section-title">Control Panel</div>
      <div class="checkbox-group">
        <label class="checkbox-item">
          <input type="checkbox" [checked]="showConnections()" (change)="onShowConnectionsChange($event)" />
          <span>Show Connections</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" [checked]="showDataFlow()" (change)="onShowDataFlowChange($event)" />
          <span>Show Data Flow</span>
        </label>
      </div>
    </section>

    <section class="sidebar-section">
      <div class="section-title">Network Configuration</div>
      <div class="control-panel">
        <div class="control-group">
          <div class="slider-container">
            <div class="control-row">
              <label class="control-label">Network Size</label>
              <span class="slider-value">{{ nodeCount() }} nodes</span>
            </div>
            <input
              type="range"
              min="20"
              max="100"
              step="5"
              [value]="nodeCount()"
              (input)="onNodeCountChange($event)"
              [disabled]="isPlaying()"
            />
          </div>
        </div>

        <div class="control-group">
          <div class="slider-container">
            <div class="control-row">
              <label class="control-label">Animation Speed</label>
              <span class="slider-value">{{ animationSpeed() | number: '1.1-1' }}x</span>
            </div>
            <input
              type="range"
              min="0.5"
              max="3"
              step="0.1"
              [value]="animationSpeed()"
              (input)="onAnimationSpeedChange($event)"
              [disabled]="isPlaying()"
            />
          </div>
        </div>

        <div class="control-group">
          <div class="slider-container">
            <div class="control-row">
              <label class="control-label">P2P Node Degree</label>
              <span class="slider-value">{{ averageDegree() }}</span>
            </div>
            <input
              type="range"
              min="2"
              max="8"
              step="1"
              [value]="averageDegree()"
              (input)="onAverageDegreeChange($event)"
              [disabled]="isPlaying()"
            />
          </div>
        </div>
      </div>
    </section>

    <section class="sidebar-section">
      <div class="section-title">TGL Parameters</div>
      <div class="control-panel">
        <div class="control-group">
          <label class="control-label" for="pushBudget">Push Budget</label>
          <select
            id="pushBudget"
            class="dropdown"
            [value]="pushBudget()"
            (change)="onPushBudgetChange($event)"
            [disabled]="isPlaying()"
          >
            @for (option of pushBudgetOptions; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
        </div>

        <div class="control-group">
          <label class="control-label" for="gossipBudget">Gossip Budget</label>
          <select
            id="gossipBudget"
            class="dropdown"
            [value]="gossipBudget()"
            (change)="onGossipBudgetChange($event)"
            [disabled]="isPlaying()"
          >
            @for (option of gossipBudgetOptions; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
        </div>

        <div class="control-group">
          <label class="control-label" for="pullBudget">Pull Budget</label>
          <select
            id="pullBudget"
            class="dropdown"
            [value]="pullBudget()"
            (change)="onPullBudgetChange($event)"
            [disabled]="isPlaying()"
          >
            @for (option of pullBudgetOptions; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
        </div>
      </div>
    </section>
  </aside>

  <main class="content-area">
    <div class="networks-grid">
      <div class="network-viewport">
        <app-network-canvas networkType="p2p"></app-network-canvas>
      </div>
      <div class="network-viewport">
        <app-network-canvas networkType="tgl"></app-network-canvas>
      </div>
    </div>

    <div class="viewport-label left">Peer-to-Peer Network</div>
    <div class="viewport-label right">Tiered Gossip Learning (TGL)</div>
    <div class="stage-badge">{{ stageBadgeText() }}</div>
  </main>

  <section class="metrics-panel">
    <div class="metric-card">
      <div class="metric-header">
        <span>Peer-to-Peer Network</span>
        <span class="metric-badge">BASELINE</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Round</span>
        <span class="metric-value neutral">{{ p2pRound() }}</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Messages</span>
        <span class="metric-value p2p">{{ p2pMessages() }}</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Coverage</span>
        <span class="metric-value p2p">{{ p2pCoverageLabel() }}</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill p2p" [style.width]="p2pProgressWidth()"></div>
      </div>
    </div>

    <div class="metric-card highlight">
      <div class="metric-header">Comparison</div>
      <div class="comparison-card">
        <div class="comparison-row">
          <div class="comparison-icon">üìâ</div>
          <div class="comparison-text">
            <div class="comparison-label">Msg Reduction</div>
            <div class="comparison-value">{{ messageReductionLabel() }}</div>
          </div>
        </div>
        <div class="comparison-row">
          <div class="comparison-icon">‚ö°</div>
          <div class="comparison-text">
            <div class="comparison-label">Speed Gain</div>
            <div class="comparison-value">{{ speedGainLabel() }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-header">
        <span>Tiered Gossip Learning</span>
        <span class="metric-badge tgl">TGL</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Round</span>
        <span class="metric-value neutral">{{ tglRound() }}</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Messages</span>
        <span class="metric-value tgl">{{ tglMessages() }}</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Coverage</span>
        <span class="metric-value tgl">{{ tglCoverageLabel() }}</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill tgl" [style.width]="tglProgressWidth()"></div>
      </div>
    </div>
  </section>
</div>
