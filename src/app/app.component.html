<div class="page-wrapper">
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Tiered Gossip Learning</h1>
      <p class="hero-subtitle">Scalable Collaborative Learning Without Coordination</p>
      
      <div class="hero-stats">
        <div class="stat-card">
          <div class="stat-number">3√ó</div>
          <div class="stat-label">Less Communication</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">2/3</div>
          <div class="stat-label">Fewer Exchanges</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">100%</div>
          <div class="stat-label">Fully Decentralized</div>
        </div>
      </div>

      <p class="hero-description">
        Tiered Gossip Learning (TGL) combines the fault tolerance of peer-to-peer training with the efficiency of hierarchical aggregation. 
        Explore this interactive visualization of TGL's three-stage communication process: leaves push models to relays, relays gossip among themselves, 
        and leaves pull updated models‚Äîall without central coordination. Watch real-time communication patterns as distributed devices exchange models 
        through randomized connections, demonstrating how hierarchical structure and decentralized aggregation enable scalable, efficient training.
      </p>

      <button class="hero-button" (click)="scrollToDemo()">
        View Demo
        <span class="scroll-icon">‚Üì</span>
      </button>
    </div>
  </section>

  <!-- Demo Section -->
  <div class="container" id="demo-section">
  <!-- Left Sidebar - Compact Info Panels -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1>P2P vs TGL Network</h1>
      <p>Interactive Propagation Demo</p>
    </div>

    <!-- Configuration Controls -->
    <section class="sidebar-section">
      <div class="section-title">Network Configuration</div>
      <div class="control-panel">
        <div class="control-group">
          <div class="slider-container">
            <div class="control-row">
              <label class="control-label">Network Size</label>
              <span class="slider-value">{{ nodeCount() }} nodes</span>
            </div>
            <input
              type="range"
              min="20"
              max="100"
              step="5"
              [value]="nodeCount()"
              (input)="onNodeCountChange($event)"
              [disabled]="isPlaying()"
            />
          </div>
        </div>

        <div class="control-group">
          <div class="slider-container">
            <div class="control-row">
              <label class="control-label">Animation Speed</label>
              <span class="slider-value">{{ animationSpeed() | number: '1.2-2' }}x</span>
            </div>
            <input
              type="range"
              min="0.25"
              max="3"
              step="0.25"
              [value]="animationSpeed()"
              (input)="onAnimationSpeedChange($event)"
              [disabled]="isPlaying()"
            />
          </div>
        </div>
        <div class="control-group">
          <div class="slider-container">
            <div class="control-row">
              <label class="control-label">P2P Node Degree</label>
              <span class="slider-value">{{ averageDegree() }}</span>
            </div>
            <input
              type="range"
              min="2"
              max="8"
              step="1"
              [value]="averageDegree()"
              (input)="onAverageDegreeChange($event)"
              [disabled]="isPlaying()"
            />
          </div>
        </div>
      </div>
    </section>

    <section class="sidebar-section">
      <div class="section-title">TGL Parameters</div>
      <div class="control-panel">
        <div class="control-group">
          <label class="control-label" for="pushBudget">Push Budget</label>
          <select
            id="pushBudget"
            class="dropdown"
            [value]="pushBudget()"
            (change)="onPushBudgetChange($event)"
            [disabled]="isPlaying()"
          >
            @for (option of pushBudgetOptions; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
        </div>

        <div class="control-group">
          <label class="control-label" for="gossipBudget">Gossip Budget</label>
          <select
            id="gossipBudget"
            class="dropdown"
            [value]="gossipBudget()"
            (change)="onGossipBudgetChange($event)"
            [disabled]="isPlaying()"
          >
            @for (option of gossipBudgetOptions; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
        </div>

        <div class="control-group">
          <label class="control-label" for="pullBudget">Pull Budget</label>
          <select
            id="pullBudget"
            class="dropdown"
            [value]="pullBudget()"
            (change)="onPullBudgetChange($event)"
            [disabled]="isPlaying()"
          >
            @for (option of pullBudgetOptions; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
        </div>
      </div>
    </section>

    <!-- Info Banner Content (Compact Vertical) -->
    <app-info-banner></app-info-banner>

    <!-- Legend -->
    <section class="sidebar-section">
      <div class="section-title">Legend</div>
      <div class="legend-items">
        @for (item of legendItems; track item.label) {
          <div class="legend-item">
            <div class="legend-dot" [style.background]="item.color"></div>
            <span>{{ item.label }}</span>
          </div>
        }
      </div>
    </section>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Top Controls Bar -->
    <div class="controls-bar">
      <div class="interaction-tips">
        <span class="tip-icon">üí°</span>
        <span class="tip-text">Scroll to zoom ‚Ä¢ Drag to rotate ‚Ä¢ Right-click to pan</span>
      </div>
      <div class="controls-center">
        <div class="round-display">
          Round: <strong>{{ currentRound() }}</strong>
        </div>
        <div class="playback-controls">
          <button class="control-btn" type="button" disabled title="Previous Round">‚èÆ</button>
          <button class="control-btn primary" type="button" (click)="togglePlayback()" title="Play/Pause">
            {{ isPlaying() ? '‚è∏' : '‚ñ∂' }}
          </button>
          <button class="control-btn" type="button" disabled title="Next Round">‚è≠</button>
          <button class="control-btn" type="button" (click)="onReset()" title="Reset">üîÑ</button>
        </div>
      </div>
    </div>

    <!-- Visualization Area -->
    <div class="visualization">
      <div class="viz-panel">
        <div class="viz-header">
          <span>Peer-to-Peer Network</span>
          <span class="viz-badge">BASELINE</span>
        </div>
        <div class="canvas-area">
          <app-network-canvas networkType="p2p"></app-network-canvas>
        </div>
      </div>

      <div class="viz-panel">
        <div class="viz-header">
          <span>Tiered Gossip Learning (TGL)</span>
          <span class="viz-badge tgl">TGL</span>
        </div>
        <div class="canvas-area">
          <app-network-canvas networkType="tgl"></app-network-canvas>
          <div class="stage-indicator">{{ stageBadgeText() }}</div>
        </div>
      </div>
    </div>

    <!-- Bottom Stats Bar -->
    <div class="stats-bar">
      <!-- P2P Stats -->
      <div class="stat-group">
        <div class="stat-item" title="Latest round reached by the baseline flooding network">
          <span class="stat-label">P2P Round</span>
          <span class="stat-value baseline">{{ p2pRound() }}</span>
        </div>
        <div class="stat-item" title="Cumulative peer-to-peer message exchanges">
          <span class="stat-label">P2P Messages</span>
          <span class="stat-value baseline">{{ p2pMessages() }}</span>
        </div>
        <div class="stat-item" title="Share of nodes that already received the update in the P2P network">
          <span class="stat-label">P2P Coverage</span>
          <span class="stat-value baseline">{{ p2pCoverageLabel() }}</span>
        </div>
      </div>

      <div class="comparison-divider"></div>

      <!-- Comparison Metrics -->
      <div class="comparison-metrics">
        <div class="metric" title="Real-time speed advantage of TGL vs baseline flooding">
          <span class="metric-icon">‚ö°</span>
          <div class="metric-content">
            <span class="metric-label">Current Speed Gain</span>
            <span class="metric-value" [class.positive]="speedGain() && speedGain()! > 0">{{ speedGainLabel() }}</span>
          </div>
        </div>
      </div>

      <div class="comparison-divider"></div>

      <!-- TGL Stats -->
      <div class="stat-group">
        <div class="stat-item" title="Latest round reached by the Tiered Gossip Learning run">
          <span class="stat-label">TGL Round</span>
          <span class="stat-value tgl">{{ tglRound() }}</span>
        </div>
        <div class="stat-item" title="Cumulative Tiered Gossip message exchanges">
          <span class="stat-label">TGL Messages</span>
          <span class="stat-value tgl">{{ tglMessages() }}</span>
        </div>
        <div class="stat-item" title="Share of nodes that already received the update in the TGL network">
          <span class="stat-label">TGL Coverage</span>
          <span class="stat-value tgl">{{ tglCoverageLabel() }}</span>
        </div>
      </div>
    </div>
  </main>

  @if (showCoveragePopup()) {
    <div class="coverage-popup-backdrop">
      <div class="coverage-popup">
        <p class="coverage-popup-eyebrow">Run Complete</p>
        <h3>Coverage reached with a clear exchange gap</h3>
        @if (completionStats(); as stats) {
          @if (coverageDifference(); as diff) {
            <p class="coverage-popup-body">
              TGL reached 100% coverage with
              <strong>{{ diff.percent }}% {{ diff.direction }}</strong>
              exchanges than baseline P2P.
            </p>
          } @else {
            <p class="coverage-popup-body">
              TGL finished the run with measurable savings over baseline flooding.
            </p>
          }

          <div class="coverage-popup-grid">
            @for (stat of stats; track stat.id) {
              <div class="coverage-card">
                <div class="coverage-card-header">
                  <span class="coverage-card-title">{{ stat.title }}</span>
                  <span
                    class="coverage-card-badge"
                    [class.positive]="stat.positive === true"
                    [class.negative]="stat.positive === false"
                  >
                    {{ stat.diffLabel }}
                  </span>
                </div>
                <p class="coverage-card-subtitle">{{ stat.subtitle }}</p>
                <div class="coverage-card-values">
                  <div class="coverage-card-value">
                    <span class="value-label">TGL</span>
                    <span class="value-number">{{ stat.tglValue }}</span>
                  </div>
                  <div class="coverage-card-value">
                    <span class="value-label baseline">P2P</span>
                    <span class="value-number baseline">{{ stat.p2pValue }}</span>
                  </div>
                </div>
                <span class="coverage-card-note">{{ stat.descriptor }}</span>
              </div>
            }
          </div>
        } @else {
          <p class="coverage-popup-body">
            Coverage results are ready as soon as both simulations finish.
          </p>
        }
        <button type="button" class="coverage-popup-button" (click)="dismissCoveragePopup()">
          Continue Exploring
        </button>
      </div>
    </div>
  }
</div>
</div>
